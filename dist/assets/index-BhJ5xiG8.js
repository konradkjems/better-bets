(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();const g="https://better-bets-api.vercel.app/api";let l=null;function d(){return window.location.pathname==="/"||window.location.pathname==="/login.html"||window.location.pathname==="/register.html"}async function f(a,s){try{console.log("Forsøger at logge ind...");const o=await fetch(`${g}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:s})});console.log("Server svar status:",o.status);const n=o.headers.get("content-type");if(console.log("Content-Type:",n),!o.ok){let t;try{t=(await o.json()).message||"Der skete en fejl ved login"}catch(r){console.error("Kunne ikke parse fejlbesked:",r),t="Der skete en uventet fejl ved login"}throw new Error(t)}const e=await o.json();l=e.user,localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user)),window.location.href="/calculator.html"}catch(o){console.error("Login fejl:",o),alert(o instanceof Error?o.message:"Der skete en fejl ved login")}}async function h(a,s,o,n){try{if(!a||!s||!o||!n)throw new Error("Alle felter skal udfyldes");if(o!==n)throw new Error("Adgangskoderne matcher ikke");if(o.length<8)throw new Error("Adgangskoden skal være mindst 8 tegn lang");const e=await fetch(`${g}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:s,password:o})});if(!e.ok){const r=await e.json();throw new Error(r.message||"Der skete en fejl ved registrering")}const t=await e.json();l=t.user,localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),window.location.href="/calculator.html"}catch(e){alert(e instanceof Error?e.message:"Der skete en fejl ved registrering")}}document.addEventListener("DOMContentLoaded",()=>{const a=localStorage.getItem("user"),s=localStorage.getItem("token");a&&s?(l=JSON.parse(a),d()&&(window.location.href="/calculator.html")):d()||(window.location.href="/login.html");const o=document.getElementById("loginForm");o==null||o.addEventListener("submit",r=>{r.preventDefault();const i=document.getElementById("loginEmail").value,c=document.getElementById("loginPassword").value;f(i,c)});const n=document.getElementById("registerForm");n==null||n.addEventListener("submit",r=>{r.preventDefault();const i=document.getElementById("registerName").value,c=document.getElementById("registerEmail").value,u=document.getElementById("registerPassword").value,m=document.getElementById("registerPasswordConfirm").value;h(i,c,u,m)});const e=document.getElementById("logoutButton");e==null||e.addEventListener("click",()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login.html"});const t=document.getElementById("userEmail");t&&l&&(t.textContent=l.email)});
